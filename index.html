<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="language" content="bahasa">
	<meta http-equiv="Content-Type" content="text/html">
	<meta http-equiv="Content-Style-Type" content="text/css">
    <meta http-equiv="Content-Script-Type" content="text/javascript">
	<meta name="description" content="Karena memilih lewat Pemilu, bukan seperti melempar dadu. Kita semua yang akan menentukan, nasib Indonesia di masa depan."/>
	<meta name="keywords" content="Pantau KPU, Pemilu, Pemilihan Umum, Komisi Pemilihan Umum, Kawal KPU, Indonesia, Pemilihan Presiden, Pilpres, Kampanye">
    <meta name="robots" content="index,follow">
    <meta name="distribution" content="web">
	<meta name="rating" content="general">
	<meta name="msapplication-TileImage" content="favicon.png">
    <!-- CSS -->
	<link rel="icon" type="image/png" href="favicon.png">
	<link rel="shortcut icon" type="image/png" href="favicon.png"/>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0/dist/fancybox/fancybox.css" crossorigin="anonymous"/>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/fontawesome.min.css" integrity="sha512-d0olNN35C6VLiulAobxYHZiXJmq+vl+BGIgAxQtD5+kqudro/xNMvv2yIHAciGHpExsIbKX3iLg+0B6d0k4+ZA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/solid.min.css" integrity="sha512-pZlKGs7nEqF4zoG0egeK167l6yovsuL8ap30d07kA5AJUq+WysFlQ02DLXAmN3n0+H3JVz5ni8SJZnrOaYXWBA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
	<!-- JS -->
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/js/fontawesome.min.js" integrity="sha512-C8qHv0HOaf4yoA7ISuuCTrsPX8qjolYTZyoFRKNA9dFKnxgzIHnYTOJhXQIt6zwpIFzCrRzUBuVgtC4e5K1nhA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/js/solid.min.js" integrity="sha512-+fI924YJzeYFv7M0R29zJvRThPinSUOAmo5rpR9v6G4eWIbva/prHdZGSPN440vuf781/sOd/Fr+5ey0pqdW9w==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
	<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11" crossorigin="anonymous"></script>
	<script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0/dist/fancybox/fancybox.umd.js" crossorigin="anonymous"></script>
	<script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/shim.min.js" crossorigin="anonymous"></script>
	<script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js" crossorigin="anonymous"></script>
	<title>Pantau KPU</title>
	<style>
	body{
		font-size: 10pt;
	}
    .bd-placeholder-img {
        font-size: 1.125rem;
        text-anchor: middle;
        -webkit-user-select: none;
        -moz-user-select: none;
        user-select: none;
    }

    @media (min-width: 768px) {
        .bd-placeholder-img-lg {
          font-size: 3.5rem;
        }
    }
	.form-check-input {
		min-width:1.2em;
		min-height:1.2em;
	}
    </style>
  </head>
  <body>
	<div class="col-lg-8 mx-auto p-3 py-md-3">
		<header class="d-flex align-items-center pb-3 mb-5 border-bottom">
			<nav class="navbar navbar-light bg-white">
				<a class="navbar-brand" href="#">
					<h1><i class="fa-regular fa-shield-cat"></i> <small>Pantau KPU</small></h1>
				</a>
			</nav>
		</header>
		<main>
			<div class="container">
				<div class="row">
					<div class="col">
					
						<figure class="text-center">
						  <blockquote class="blockquote">
							<p><em>"Karena memilih lewat Pemilu, bukan seperti melempar dadu. Kita semua yang akan menentukan, nasib Indonesia di masa depan."</em></p>
						  </blockquote>
						  <figcaption class="blockquote-footer">
							<cite title="Source Title">Najwa Shihab</cite>
						  </figcaption>
						</figure>
						
						<fieldset style="all: revert;" class="mb-4">
							<legend style="all: revert;" class="ps-2 pe-2 text-secondary"><strong>Petunjuk Penggunaan</strong></legend>
							<div class="border border-2 rounded-1 border-light col-12">
								<ol class="list-group list-group-flush list-group-numbered">
								  <li class="list-group-item">Pastikan kondisi Browser maupun Perangkat dan Koneksi Internet anda dalam keadaan yang baik dan stabil</li>
								  <li class="list-group-item">Klik tombol <strong><i class="fa-solid fa-play"></i> Start</strong> untuk memulai pemantauan, dan Pilih Provinsi yang ingin dipantau (semakin banyak provinsi yang dipilih maka proses pemantauan akan membutuhkan waktu pemantauan semakin lama)</li>
								  <li class="list-group-item">Proses pemantauan akan memantau seluruh data TPS di KPU berdasarkan provinsi yang dipilih secara satu-persatu dan secara langsung akan memberikan laporan Anomali yang ditemukan dalam bentuk ringkasan hasil pemantauan</li>
								  <li class="list-group-item">Silahkan menunggu hingga proses pemantauan selesai atau dapat meng-klik tombol <strong><i class="fa-solid fa-stop"></i> Stop</strong> untuk menghentikan proses pemantauan</li>
								  <li class="list-group-item">Jika proses pemantauan sudah selesai atau diberhentikan maka otomatis akan menghasilkan laporan detail hasil pemantauan dalam bentuk file Spreadsheet/Excel ( .XLSX ) dan tombol "Tampilkan Detail" dapat di klik untuk melihat secara langsung</li>
								</ol>
							</div>						
						</fieldset>
						
						<button type="button" class="btn btn-success mb-2" id="start"><i class="fa-solid fa-play"></i> Start</button>
						<button type="button" class="btn btn-danger mb-2" id="stop" disabled="disabled"><i class="fa-solid fa-stop"></i> Stop</button>
						
						<div id="progress" class="d-none">
							<hr class="col-12">
							<div class="row align-middle">
								<div class="col-md-11 align-middle">
									<div class="progress">
										<div class="progress-bar progress-bar-striped progress-bar-animated" id="bar" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%"></div>
									</div>
								</div>
								<div class="col-md-1 text-center align-middle">
									<p id="percent" class="font-monospace text-primary"></p>
								</div>
								<div class="col-md-12 align-middle">
									<p id="path" class="font-monospace text-secondary"></p>
								</div>
							</div>
							<hr class="col-12">
						</div>
						
						<div id="log" class="d-none">
							<div class="border border-2 rounded-1 border-light mb-4">								
								<h5>Anomali Terpantau Saat ini</h5>
								<ul class="list-group list-group-flush">									
									<li class="list-group-item">Jumlah Perolehan Suara lebih dari 300 Suara <span id="anom1" class="badge bg-danger">0</span></li>
									<li class="list-group-item">Jumlah Perolehan Suara lebih banyak dari Jumlah Suara Sah <span id="anom2" class="badge bg-danger text-right">0</span></li>
									<li class="list-group-item">Jumlah Perolehan Suara lebih banyak dari Jumlah Pengguna Hak Pilih <span id="anom3" class="badge bg-danger">0</span></li>
									<li class="list-group-item">Jumlah Suara lebih banyak dari Jumlah Pengguna Hak Pilih <span id="anom4" class="badge bg-warning">0</span></li>
								</ul>
							</div>
							<div class="d-grid col-12">
								<div class="d-grid gap-2 col-4 mx-auto">
									<button class="btn btn-info d-block" type="button" id="detail" disabled="disabled">Tampilkan Detail</button>
								</div>
								<div class="d-grid gap-2 col-12 mx-auto">
									<div id="cards"></div>
								</div>
								<div class="d-grid gap-2 col-4 mx-auto">
									<button class="btn btn-outline-info d-none" type="button" id="more">Tampilkan Lebih Banyak</button>
								</div>
							</div>
						</diV>
					</div>
				</div>
			</div>
		</main>
		<footer class="pt-5 my-5 text-muted border-top">
			Pantau KPU &copy; 2024
		</footer>
	</div>
	<script>
		'use strict';
		
		var ctrlCollect = null;
	
		const collect = (url, optional = {}, retries = 10) => {
			if(ctrlCollect === null) ctrlCollect = new AbortController();
			const signal = ctrlCollect.signal;
			return new Promise((resolve, reject) => {
				const counter = retries - 1;
				if(counter === 0) reject('Too many retry attempts');
				fetch(url, { method: 'GET', headers: { 'Accept' : 'application/json' }, priority: 'auto', referrerPolicy: 'no-referrer', keepalive: true, signal: signal, ...optional })
				.then(async (response) =>  await response.json())
				.then((json) => resolve(json))
				.catch((error) => {
					if (counter !== 0) {
						setTimeout(async () => {
							try{
								await collect(url, optional, counter);
							}catch(err){
								reject(err);
							}
						}, 3000);
					}else{
						reject(error);
					}
				})
			});
		}

		const asyncForEach = async (array, callback) => {
			for (let index = 0; index < array.length; index++) {
			  await callback(array[index], index, array);
			}
		}

		document.addEventListener("DOMContentLoaded", async () => {
		
			const bar = document.querySelector('#bar');
			const percent = document.querySelector('#percent');
			const path = document.querySelector('#path');
			const cards = document.querySelector('#cards');
			const anom1 = document.querySelector('#anom1');
			const anom2 = document.querySelector('#anom2');
			const anom3 = document.querySelector('#anom3');
			const anom4 = document.querySelector('#anom4');
			Fancybox.bind('[data-fancybox="gallery"]');
			
			const anomali = [];
			
			const limit = 5;
			
			var progress = 0;
			var more = limit;
			
			const card = `<div class="card text-dark bg-light mb-4">
							<div class="card-header {{color}}"><h5 class="card-title fw-bold">#{{tps}}</h5></div>
							<div class="card-body">
								<div class="row g-0">
									<div class="col-md-8">
										<ul class="list-group list-group-flush">
											<li class="list-group-item lh-sm">Lokasi TPS : {{path}}</li>	
											<li class="list-group-item lh-sm fw-bold">Jumlah Suara : {{total}}</li>																				
											<li class="list-group-item lh-sm" style="list-style-type: disc;display: list-item;margin-left: 2.5em;padding-left: 0em;">Suara Sah : {{sah}}</li>
											<li class="list-group-item lh-sm" style="list-style-type: disc;display: list-item;margin-left: 2.5em;padding-left: 0em;">Suara Tidak Sah : {{tidaksah}}</li>
											<li class="list-group-item lh-sm fw-bold">Jumlah Perolehan Suara : {{perolehan}}</li>
											<li class="list-group-item lh-sm" style="list-style-type: disc;display: list-item;margin-left: 2.5em;padding-left: 0em;">Perolehan Suara Pasangan 01 : {{p01}}</li>
											<li class="list-group-item lh-sm" style="list-style-type: disc;display: list-item;margin-left: 2.5em;padding-left: 0em;">Perolehan Suara Pasangan 02 : {{p02}}</li>
											<li class="list-group-item lh-sm" style="list-style-type: disc;display: list-item;margin-left: 2.5em;padding-left: 0em;">Perolehan Suara Pasangan 03 : {{p03}}</li>																				
											<li class="list-group-item lh-sm fw-bold">Jumlah Pengguna Hak Pilih : {{dpt}}</li>	
											<li class="list-group-item lh-sm fw-bold">Anomali : <mark>{{keterangan}}</mark></li>	
											<li class="list-group-item lh-sm"><a target="_blank" href="{{link}}" class="btn alert-info">Buka di Website KPU</a></li>
										</ul>
									</div>
									<div class="col-md-4">
										<div class="container">
										  <div class="row">{{images}}</div>
										</div>
									</div>
								</div>
							</div>
						</div>`;
		
			document.querySelector('#start').addEventListener("click", async () => {
		
				try{
					
					const result = await Swal.fire({
											title: 'Anda yakin?',
											width: '40em',
											allowOutsideClick: false,
											allowEscapeKey: false,
											allowEnterKey: false,
											focusConfirm: false,
											html: 'Selama proses pemantauan dimohon untuk <strong>Tidak menutup dan/atau mematikan Browser maupun Perangkat, dan pastikan Koneksi Internet anda dalam keadaan stabil</strong> saat proses pemantauan berlangsung.',
											icon: 'info',
											showCancelButton: true,
											confirmButtonText: `<i class="fa-solid fa-play"></i> Pantau`,
											cancelButtonText: `<i class="fa-solid fa-xmark"></i> Batal`,
										});
										
					if(!result.isConfirmed) {
						return false;
					}
					
					cards.innerHTML = '';
					ctrlCollect = null;
					progress = 0;
					more = limit;
					anom1.innerText = 0;
					anom2.innerText = 0;
					anom3.innerText = 0;
					anom4.innerText = 0;
					anomali.length = 0;
					
					document.querySelector('#detail').setAttribute('disabled', 'disabled');
					
					document.querySelector('#start').setAttribute('disabled', 'disabled');
					document.querySelector('#stop').removeAttribute('disabled');
					
					document.querySelector('#progress').setAttribute('class', 'd-block');
					document.querySelector('#log').setAttribute('class', 'd-block');

					const tingkat1 = await collect('https://sirekap-obj-data.kpu.go.id/wilayah/pemilu/ppwp/0.json', { cache: 'force-cache' });
					
					
					const { value: checked } = await Swal.fire({
														title: 'Pilih Provinsi Pemantauan',
														width: '86em',
														allowOutsideClick: false,
														allowEscapeKey: false,
														allowEnterKey: false,
														focusConfirm: false,
														html: '<div class="container"><div class="row">' + tingkat1.map((row) => {
															return `<div class="col-md-3">
																	  <div class="input-group-text bg-transparent border-0">
																		<input class="form-check-input mt-0" name="provinsi[]" type="checkbox" checked="checked" value="${row.kode}" aria-label="${row.nama}"><label class="form-label mt-1 ms-2">${row.nama}</label>
																	  </div>
																	</div>`;
														}).join('') + '<div class="col-sm-3"><button type="button" class="btn btn-outline-secondary btn-sm float-start" id="slall">Pilih Semua</button><button type="button" class="btn btn-outline-secondary btn-sm float-end" id="clall">Kosongkan Semua</button></div></div></div>',
														didRender: () => {
															document.querySelector('#slall').addEventListener("click", async () => {
																[...document.querySelectorAll('input[name="provinsi[]"]')].map(row => row.setAttribute('checked', 'checked'));		
															});
															
															document.querySelector('#clall').addEventListener("click", async () => {
																[...document.querySelectorAll('input[name="provinsi[]"]')].map(row => row.removeAttribute('checked'));				
															});
														},
														preConfirm: () => {
															return [...document.querySelectorAll('input[name="provinsi[]"]:checked')].map(row => row.value);
														},
														confirmButtonText: `<i class="fa-solid fa-play"></i> Pantau`,
													});
					if (checked.length <= 0) {
						return false;
					}
					
					const filrdtingkat1 = tingkat1.filter((row) => { return checked.indexOf(row.kode) >= 0 })
					
					const tb1 = 100/filrdtingkat1.length;
					
					await asyncForEach(filrdtingkat1, async (vt1, it1) => {
					
						const tingkat2 = await collect('https://sirekap-obj-data.kpu.go.id/wilayah/pemilu/ppwp/' + vt1.kode + '.json', { cache: 'force-cache' });
						const tb2 = tb1/tingkat2.length;
					
						await asyncForEach(tingkat2, async (vt2, it2) => {
						
							const tingkat3 = await collect('https://sirekap-obj-data.kpu.go.id/wilayah/pemilu/ppwp/' + vt1.kode + '/' + vt2.kode + '.json', { cache: 'force-cache' });
							const tb3 = tb2/tingkat3.length;
						
							await asyncForEach(tingkat3, async (vt3, it3) => {
							
								const tingkat4 = await collect('https://sirekap-obj-data.kpu.go.id/wilayah/pemilu/ppwp/' + vt1.kode + '/' + vt2.kode + '/' + vt3.kode + '.json', { cache: 'force-cache' });
								const tb4 = tb3/tingkat4.length;
						
								await asyncForEach(tingkat4, async (vt4, it4) => {
								
									const tingkat5 = await collect('https://sirekap-obj-data.kpu.go.id/wilayah/pemilu/ppwp/' + vt1.kode + '/' + vt2.kode + '/' + vt3.kode + '/' + vt4.kode + '.json', { cache: 'force-cache' });
									const tb5 = tb4/tingkat5.length;
						
									await asyncForEach(tingkat5, async (vt5, it5) => {
									
										const tps = vt1.nama +  ' -> ' + vt2.nama +  ' -> ' + vt3.nama +  ' -> ' + vt4.nama +  ' -> ' + vt5.nama;
										
										progress = progress + tb5;
										
										bar.style.width = parseFloat(progress).toFixed(6) + "%";
										percent.innerText = parseFloat(progress).toFixed(2) + "%";										
										path.innerText = tps;
																			
										const data = await collect('https://sirekap-obj-data.kpu.go.id/pemilu/hhcw/ppwp/' + vt1.kode + '/' + vt2.kode + '/' + vt3.kode + '/' + vt4.kode + '/' + vt5.kode + '.json', { cache: 'no-cache' });
										
										if(data.status_suara && data.status_adm) {
											
											const perolehan = data.chart['100025'] + data.chart['100026'] + data.chart['100027'];
											const sah = data.administrasi.suara_sah;
											const tidaksah = data.administrasi.suara_tidak_sah;
											const total = data.administrasi.suara_total;
											const dpt = data.administrasi.pengguna_total_j;
											
											let images ='';
											if(data.images.length > 0) {
												await asyncForEach(data.images,  async (vimg, iimg) => {
													images = images + '<a data-fancybox="gallery" class="col" style="cursor:pointer;" data-src="' + vimg + '" data-caption="' + tps + '"><img class="img-fluid" src="' + vimg + '" alt="' + tps + '"></a>'
												});
											}

											const dtlanomali = {
													provinsi: vt1.nama,
													kotakab: vt2.nama,
													kecamatan: vt3.nama,
													kelurahan: vt4.nama,
													tps: vt5.nama,
													total: total,
													sah: sah, 
													tidak_sah: tidaksah,
													total_perolehan: perolehan,
													perolehan_01: data.chart['100025'],
													perolehan_02: data.chart['100026'], 
													perolehan_03: data.chart['100027'],
													dpt: dpt,
													link: `https://pemilu2024.kpu.go.id/pilpres/hitung-suara/${vt1.kode}/${vt2.kode}/${vt3.kode}/${vt4.kode}/${vt5.kode}`,
													timestamp: new Date().toLocaleString('id-ID', { timeZone: 'Asia/Jakarta' }),
													images : images,
													path : tps
											};
												
											if(perolehan > 300) {											
												const keterangan = 'Jumlah Perolehan Suara lebih dari 300 Suara';
												dtlanomali.keterangan = keterangan;
												dtlanomali.color = 'alert-danger';											
												anomali.push(dtlanomali);
												anom1.innerText = parseInt(anom1.innerText) + 1;
											}else if(perolehan > sah) {
												const keterangan = 'Jumlah Perolehan Suara lebih banyak dari Jumlah Suara Sah';
												dtlanomali.keterangan = keterangan;
												dtlanomali.color = 'alert-danger';											
												anomali.push(dtlanomali);
												anom2.innerText = parseInt(anom2.innerText) + 1;
											}else if(perolehan > dpt) {
												const keterangan = 'Jumlah Perolehan Suara lebih banyak dari Jumlah Pengguna Hak Pilih';
												dtlanomali.keterangan = keterangan;
												dtlanomali.color = 'alert-danger';											
												anomali.push(dtlanomali);
												anom3.innerText = parseInt(anom3.innerText) + 1;
											}else if(total > dpt) {
												const keterangan = 'Jumlah Suara lebih banyak dari Jumlah Pengguna Hak Pilih';
												dtlanomali.keterangan = keterangan;
												dtlanomali.color = 'alert-warning';											
												anomali.push(dtlanomali);
												anom4.innerText = parseInt(anom4.innerText) + 1;
											}											
											
										}
									
									});
								
								});
							
							});
						
						});
					
					});
					
					document.querySelector('#stop').setAttribute('disabled', 'disabled');
					document.querySelector('#start').removeAttribute('disabled');
					document.querySelector('#detail').removeAttribute('disabled');
					bar.classList.remove('progress-bar-animated');
					const worksheet = await XLSX.utils.json_to_sheet(anomali.map((row) => {
						const data = { ...row };
						delete data.path;
						delete data.images;
						delete data.color;
						return data;
					}));
					const workbook = await XLSX.utils.book_new();
					await XLSX.utils.book_append_sheet(workbook, worksheet, "DATA TERPANTAU");
					await XLSX.utils.sheet_add_aoa(worksheet, [['Provinsi', 'Kota/Kabupaten', 'Kecamatan', 'Kelurahan', 'TPS', 'Jumlah Suara', 'Suara Sah', 'Suara Tidak Sah', 'Jumlah Perolehan Suara', 'Perolehan Suara Pasangan 01', 'Perolehan Suara Pasangan 02', 'Perolehan Suara Pasangan 03', 'Jumlah Pengguna Hak Pilih', 'Link Website KPU', 'Tanggal-Waktu Terpantau', 'Anomali/Penyimpangan']], { origin: "A1" });
					await XLSX.writeFile(workbook, 'Pantau_KPU_' + (new Date().toLocaleString('id-ID', { timeZone: 'Asia/Jakarta' }).replace(/\:/g, '.').replace(/\//g, '-').replace(/\s/g, '')) + '.xlsx', { compression: true });
						
				}catch(error) {
					console.log(error);
				}
			
			});
			
			document.querySelector('#stop').addEventListener("click", async () => {
			
				try {
				
					const result = await Swal.fire({
												title: 'Anda yakin?',
												width: '40em',
												allowOutsideClick: false,
												allowEscapeKey: false,
												allowEnterKey: false,
												focusConfirm: false,
												html: 'Jika proses pemantauan dihentikan maka tidak dapat dilanjutkan, dan harus dimulai dari awal kembali. ',
												icon: 'warning',
												showCancelButton: true,
												confirmButtonText: `<i class="fa-solid fa-stop"></i> Stop`,
												cancelButtonText: `<i class="fa-solid fa-xmark"></i> Batal`,
											});
											
					if(!result.isConfirmed) {
						return false;
					}
					
					document.querySelector('#stop').setAttribute('disabled', 'disabled');
					document.querySelector('#start').removeAttribute('disabled');
					
					document.querySelector('#detail').removeAttribute('disabled');
					
					ctrlCollect.abort();
					bar.classList.remove('progress-bar-animated');
					const worksheet = await XLSX.utils.json_to_sheet(anomali.map((row) => {
						const data = { ...row };
						delete data.path;
						delete data.images;
						delete data.color;
						return data;
					}));
					const workbook = await XLSX.utils.book_new();
					await XLSX.utils.book_append_sheet(workbook, worksheet, "DATA TERPANTAU");
					await XLSX.utils.sheet_add_aoa(worksheet, [['Provinsi', 'Kota/Kabupaten', 'Kecamatan', 'Kelurahan', 'TPS', 'Jumlah Suara', 'Suara Sah', 'Suara Tidak Sah', 'Jumlah Perolehan Suara', 'Perolehan Suara Pasangan 01', 'Perolehan Suara Pasangan 02', 'Perolehan Suara Pasangan 03', 'Jumlah Pengguna Hak Pilih', 'Link Website KPU', 'Tanggal-Waktu Terpantau', 'Anomali/Penyimpangan']], { origin: "A1" });
					await XLSX.writeFile(workbook, 'Pantau_KPU_' + (new Date().toLocaleString('id-ID', { timeZone: 'Asia/Jakarta' }).replace(/\:/g, '.').replace(/\//g, '-').replace(/\s/g, '')) + '.xlsx', { compression: true });
					
				}catch(error) {
					console.log(error);
				}
				
			});

			document.querySelector('#detail').addEventListener("click", async () => {
				
				try{
			
					document.querySelector('#detail').classList.remove('d-block');
					document.querySelector('#detail').classList.add('class', 'd-none');
					document.querySelector('#more').classList.remove('d-none');
					document.querySelector('#more').classList.add('d-block');
					
					if(anomali.length < more){
						more = anomali.length;
					}
				
					await asyncForEach(anomali.slice(0, limit),  async (vdt, idt) => {					
						cards.insertAdjacentHTML('beforeend', 
							card.replace('{{color}}', vdt.color)
								.replace('{{tps}}', vdt.tps)
								.replace('{{path}}', vdt.path )
								.replace('{{total}}', vdt.total)
								.replace('{{sah}}', vdt.sah)
								.replace('{{tidaksah}}', vdt.tidak_sah)
								.replace('{{perolehan}}', vdt.total_perolehan)
								.replace('{{p01}}', vdt.perolehan_01)
								.replace('{{p02}}', vdt.perolehan_02)
								.replace('{{p03}}', vdt.perolehan_03)
								.replace('{{dpt}}', vdt.dpt)
								.replace('{{keterangan}}', vdt.keterangan)
								.replace('{{images}}', vdt.images)
								.replace('{{link}}', vdt.link)
						);
					});
					
				}catch(error) {
					console.log(error);
				}
			
			});
			
			document.querySelector('#more').addEventListener("click", async () => {
				
				try{
				
					if(anomali.length <= more){
						await Swal.fire({
									title: 'Information',
									width: '40em',
									allowOutsideClick: false,
									allowEscapeKey: false,
									allowEnterKey: false,
									focusConfirm: false,
									html: 'Detail sudah ditampilkan seluruhnya.',
									icon: 'info',
									confirmButtonText: `OK`,
								});
						return false;
					}
					
					const offset = more + limit;
				
					await asyncForEach(anomali.slice(more, offset),  async (vdt, idt) => {					
						cards.insertAdjacentHTML('beforeend', 
							card.replace('{{color}}', vdt.color)
								.replace('{{tps}}', vdt.tps)
								.replace('{{path}}', vdt.path )
								.replace('{{total}}', vdt.total)
								.replace('{{sah}}', vdt.sah)
								.replace('{{tidaksah}}', vdt.tidak_sah)
								.replace('{{perolehan}}', vdt.total_perolehan)
								.replace('{{p01}}', vdt.perolehan_01)
								.replace('{{p02}}', vdt.perolehan_02)
								.replace('{{p03}}', vdt.perolehan_03)
								.replace('{{dpt}}', vdt.dpt)
								.replace('{{keterangan}}', vdt.keterangan)
								.replace('{{images}}', vdt.images)
								.replace('{{link}}', vdt.link)
						);
						more = more + 1;				
					});
					
				}catch(error) {
					console.log(error);
				}
			
			});

		});
	</script>
  </body>
</html>
